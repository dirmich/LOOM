# LOOM 리소스 변환 가이드

LOOM의 모든 리소스를 실제 확인 가능한 파일 포맷으로 변환하는 방법입니다.

## 📋 변환 프로세스

### 1단계: 리소스 추출 및 디코딩

```bash
python3 decode_all_resources_complete.py
```

**생성 결과:**
- `decoded/` 디렉토리
  - `resources.json` - 모든 리소스 메타데이터
  - `room_XX/` - Room별 디렉토리
    - `background/background.bin` - 재구성된 배경 이미지 (width, height, strip offset table, strip data)
    - `graphics/res_XXX.bin` - 오브젝트 그래픽 (원본)
    - `sounds/res_XXX.bin` - 사운드 데이터 (원본)
    - `scripts/res_XXX.bin` - 스크립트 바이트코드 (원본)

### 2단계: 실제 파일 포맷으로 변환

```bash
python3 decode_to_real_files.py
```

**생성 결과:**
- `converted/` 디렉토리
  - `room_XX/` - Room별 디렉토리
    - `background.png` - 🖼️ **PNG 이미지** (320×144, 960×144 등)
    - `sounds/res_XXX.wav` - 🔊 **WAV 사운드** (8-bit mono, 11025 Hz)
    - `scripts/res_XXX.txt` - 📜 **TXT 스크립트** (hex dump)
    - `graphics/res_XXX.bin` - 오브젝트 그래픽 (아직 디코딩 미지원)

## 📊 변환 통계

- **총 74개 Room**
- **954개 리소스**
  - 🖼️ 73개 배경 이미지 (PNG)
  - 🔊 162개 사운드 (WAV)
  - 📜 95개 스크립트 (TXT)
  - 🎨 438개 그래픽 오브젝트 (원본)
  - ❓ 186개 미분류

## 🖼️ 이미지 포맷

### PNG 이미지
- **포맷**: RGB PNG
- **팔레트**: EGA 16색
- **크기**: Room마다 다름
  - Room 01: 320×144 (LUCASFILM GAMES 타이틀)
  - Room 02: 960×144 (산 풍경)
  - Room 05: 704×144 (황금 텐트 마을)
  - Room 09: 320×144 (거대한 Loom 기계)

### EGA 16색 팔레트
```python
0: Black (0x000000)        8: Dark Gray (0x555555)
1: Blue (0x0000AA)         9: Light Blue (0x5555FF)
2: Green (0x00AA00)       10: Light Green (0x55FF55)
3: Cyan (0x00AAAA)        11: Light Cyan (0x55FFFF)
4: Red (0xAA0000)         12: Light Red (0xFF5555)
5: Magenta (0xAA00AA)     13: Light Magenta (0xFF55FF)
6: Brown (0xAA5500)       14: Yellow (0xFFFF55)
7: Light Gray (0xAAAAAA)  15: White (0xFFFFFF)
```

## 🔊 사운드 포맷

### WAV 사운드
- **포맷**: WAV (RIFF)
- **채널**: Mono (1채널)
- **비트 깊이**: 8-bit unsigned
- **샘플레이트**: 11025 Hz
- **참고**: SCUMM v3의 실제 사운드는 PC Speaker beeps, AdLib music 등 다양한 포맷입니다. 현재는 Raw PCM으로 가정하여 변환합니다.

## 📜 스크립트 포맷

### TXT 스크립트
- **포맷**: Hex dump + ASCII
- **내용**: SCUMM v3 바이트코드의 hex dump
- **참고**: 완전한 디스어셈블은 아직 구현되지 않았습니다.

**예시:**
```
SCUMM v3 Script - 268 bytes
============================================================

0000  02 17 1C 73 FF 17 1C 78 FF 17 1C 6E FF 17 1C 68  ...s...x...n...h
0010  FF 17 1C 5E FF 17 1C 54 FF 17 1C 4A FF 17 1C 40  ...^...T...J...@
...
```

## 🚀 사용 예시

### 이미지 확인
```bash
# macOS
open converted/room_01/background.png

# Linux
xdg-open converted/room_01/background.png

# Windows
start converted/room_01/background.png
```

### 사운드 재생
```bash
# macOS
afplay converted/room_01/sounds/res_005.wav

# Linux
aplay converted/room_01/sounds/res_005.wav

# Windows
start converted/room_01/sounds/res_005.wav
```

### 스크립트 확인
```bash
cat converted/room_01/scripts/res_009.txt
```

## 🔧 필수 요구사항

### Python 패키지
```bash
# 이미지 변환 (PIL)
pip3 install Pillow

# 사운드 변환 (wave는 Python 표준 라이브러리)
# 추가 설치 불필요
```

### 시스템 요구사항
- Python 3.6 이상
- 디스크 공간: 약 50MB (`decoded/` + `converted/`)

## 📁 디렉토리 구조

```
LOOM/
├── decode_all_resources_complete.py  # 1단계: 디코딩
├── decode_to_real_files.py          # 2단계: 변환
├── decoded/                         # 디코딩된 원본
│   ├── resources.json
│   └── room_XX/
│       ├── background/
│       ├── graphics/
│       ├── sounds/
│       └── scripts/
└── converted/                       # 변환된 실제 파일
    └── room_XX/
        ├── background.png          # 🖼️ PNG
        ├── sounds/
        │   └── *.wav              # 🔊 WAV
        ├── scripts/
        │   └── *.txt              # 📜 TXT
        └── graphics/
            └── *.bin              # 오브젝트 (원본)
```

## 🎯 다음 단계

### 오브젝트 그래픽 디코딩
현재 `graphics/res_XXX.bin` 파일들은 원본 포맷 그대로입니다. 이들도 PNG로 변환하려면:
1. 각 오브젝트의 포맷 파악 필요
2. SCUMM v3 오브젝트 그래픽 디코더 구현
3. PNG 변환 추가

### 사운드 포맷 개선
SCUMM v3는 다양한 사운드 포맷을 사용합니다:
- PC Speaker beeps
- AdLib (OPL2) music
- Raw PCM samples

각 포맷을 정확히 식별하고 적절한 변환 필요.

### 스크립트 디스어셈블러
SCUMM v3 opcode 디스어셈블러 구현으로 스크립트를 읽기 쉬운 어셈블리 코드로 변환.

## 📚 참고 자료

- [ScummVM Source Code](https://github.com/scummvm/scummvm)
- [SCUMM v3 Formats](./SCUMM_V3_FORMATS.md)
- [최종성공_20251018.md](./최종성공_20251018.md)
